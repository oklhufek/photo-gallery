<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Pokédex</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Pokédex</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-searchbar
    placeholder="Hledej podle jména"
    (ionInput)="searchChanged($event)"
  ></ion-searchbar>

  <ion-grid>
    <ion-row>
      <ion-col size="12">
        <ng-container *ngIf="!pokemonService.loadingList; else listLoading">
          <ion-list lines="none">
            <ng-container *ngFor="let p of pokemonService.filtered">
              <ion-item
                button
                detail="false"
                (click)="toggleDetail(p)"
                [class.expanded-item]="expandedPokemon === p.name"
              >
                <ion-avatar slot="start">
                  <ion-img [src]="p.image" alt="{{ p.name }}"></ion-img>
                </ion-avatar>
                <ion-label>
                  <h2>{{ p.name | titlecase }}</h2>
                  <p>#{{ p.id }}</p>
                  <ion-chip color="secondary" *ngIf="pokemonService.isInCompare(p)">
                    V porovnávači
                  </ion-chip>
                </ion-label>
              </ion-item>

              <!-- Expanded Detail Section -->
              <div class="detail-expand" *ngIf="expandedPokemon === p.name">
                <div class="ion-text-center ion-padding" *ngIf="pokemonService.loadingDetail">
                  <ion-spinner name="crescent"></ion-spinner>
                </div>

                <ion-card *ngIf="!pokemonService.loadingDetail && pokemonService.selected?.name === p.name" class="detail-card">
                  <ion-card-content>
                    <div class="ion-text-center ion-padding">
                      <ion-img
                        [src]="pokemonService.selected?.sprites?.front_default"
                        alt="{{ pokemonService.selected?.name }}"
                        style="max-width: 150px; margin: 0 auto"
                      ></ion-img>
                    </div>

                    <div class="ion-padding-vertical">
                      <strong>Typy:</strong>
                      <div>
                        <ion-chip *ngFor="let t of pokemonService.selected?.types">
                          {{ t.type.name }}
                        </ion-chip>
                      </div>
                    </div>

                    <div class="ion-padding-vertical">
                      <strong>Staty:</strong>
                      <ion-grid>
                        <ion-row *ngFor="let s of pokemonService.selected?.stats">
                          <ion-col size="6">{{ s.stat.name }}</ion-col>
                          <ion-col size="6">{{ s.base_stat }}</ion-col>
                        </ion-row>
                      </ion-grid>
                    </div>

                    <ion-button
                      expand="block"
                      color="warning"
                      (click)="toggleFavoriteFromDetail()"
                    >
                      {{
                        pokemonService.isFavorite(pokemonService.selected)
                          ? 'Odebrat z oblíbených'
                          : 'Přidat do oblíbených'
                      }}
                    </ion-button>

                    <ion-button
                      expand="block"
                      color="secondary"
                      (click)="pokemonService.addSelectedToCompare()"
                    >
                      Přidat do porovnávače
                    </ion-button>
                  </ion-card-content>
                </ion-card>
              </div>
            </ng-container>
          </ion-list>

          <ion-buttons class="ion-padding" style="justify-content: center">
            <ion-button (click)="prevPage()" [disabled]="!pokemonService.prevUrl">
              Prev
            </ion-button>
            <ion-button (click)="nextPage()" [disabled]="!pokemonService.nextUrl">
              Next
            </ion-button>
          </ion-buttons>
        </ng-container>

        <ng-template #listLoading>
          <div class="ion-text-center ion-padding">
            <ion-spinner name="crescent"></ion-spinner>
          </div>
        </ng-template>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>